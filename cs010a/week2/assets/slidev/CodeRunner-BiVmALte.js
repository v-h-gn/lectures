const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/slidev/shiki-CqTp1krF.js","assets/monaco/bundled-types-DTJSzuqq.js","assets/modules/file-saver-C8QSpN-3.js","assets/modules/vue-BqWBfI5q.js","assets/monaco/bundled-types-DOh7u5h1.css","assets/modules/shiki-CDlTHkCk.js","assets/modules/shiki-CozCpemh.css"])))=>i.map(i=>d[i]);
import{r as _,d as F,G as Y,f as p,o as u,z as q,U as K,P as X,aR as Z,S as Q,D as tt,ah as et,ai as nt,i as I,an as st,g as M,t as k,X as S,F as C,ak as P,b as ot,n as it,H as at,k as rt,e as ct,w as lt}from"../modules/vue-BqWBfI5q.js";import{n as dt,_ as U,l as ut,k as E}from"../monaco/bundled-types-DTJSzuqq.js";import{aa as pt,a as V,a5 as mt}from"../index-CE5UNFIy.js";import{u as ft}from"./context-D708MgX9.js";import{_ as ht}from"./IconButton.vue_vue_type_script_setup_true_lang-DCn36NCI.js";import"../modules/file-saver-C8QSpN-3.js";import"../modules/shiki-CDlTHkCk.js";const j={},vt="slidev-addon-cpp-runner",gt="0.1.2",_t="module",yt={build:"slidev build",dev:"slidev --open",export:"slidev export"},St="MIT",bt=["slidev-addon","c","c++","coliru"],xt="A Slidev addon that allows you to run C + C++ code in your slides.",Ct={coliru:{compileUrl:"https://coliru.stacked-crooked.com/compile",shareUrl:"https://coliru.stacked-crooked.com/share"}},Ot={type:"git",url:"https://github.com/SOHNE/slidev-addon-cpp-runner.git"},wt={name:"Leandro Peres",email:"leandro@peres.dev",url:"https://github.com/zschzen"},Lt=["setup","README.md","LICENSE","vite.config.ts"],$t={"@slidev/cli":"latest","@slidev/client":"latest","@slidev/theme-default":"latest","@slidev/types":"latest","@types/node":"latest",vue:"latest"},kt={name:vt,version:gt,type:_t,scripts:yt,license:St,keywords:bt,description:xt,config:Ct,repository:Ot,author:wt,files:Lt,devDependencies:$t},A="-Wall -Wextra -pedantic -pthread -pedantic-errors",R="-lm",w="O2",N={ALWAYS_SHOW:'2>&1 | sed "s/^/☘ /"; if [ -x a.out ]; then ./a.out | sed "s/^/☢ /"; fi',DEFAULT:"&& ./a.out"},T={c:[{name:"gcc-4.9",standards:["c89","c99","c11"],additionalLibs:{c11:"-latomic"}},{name:"g++-4.9",standards:["c89","c99","c11"],additionalLibs:{c11:"-latomic"}},{name:"g++-5.2",standards:["c89","c99","c11"],additionalLibs:{c11:"-latomic"}},{name:"g++",standards:["c89","c99","c11","c17","c2x"],additionalLibs:{c11:"-latomic",c17:"-latomic",c2x:"-latomic"}},{name:"clang",standards:["c89"]},{name:"clang++",standards:["c99","c11"],additionalLibs:{c11:"-latomic"}}],cpp:[{name:"g++-4.9",standards:["c++98","c++11","c++14"],additionalLibs:{"c++11":"-latomic","c++14":"-latomic"}},{name:"g++-5.2",standards:["c++98","c++11","c++14","c++1z"],additionalLibs:{"c++11":"-latomic","c++14":"-latomic","c++1z":"-latomic"}},{name:"g++",standards:["c++98","c++11","c++14","c++17","c++20","c++23"],additionalLibs:{"c++11":"-latomic","c++14":"-latomic","c++17":"-latomic","c++20":"-latomic","c++23":"-latomic"}},{name:"clang++",standards:["c++98","c++11","c++14","c++17"],stdlibFlag:"-stdlib=libc++",additionalLibs:{"c++11":"-latomic -lsupc++","c++14":"-latomic -lsupc++","c++17":"-latomic -lsupc++"}}]},Et={compiler:"gcc",standard:"c2x",optimization:w,flags:A,libraries:`${R} -latomic`,extraCommands:"",alwaysShowCompilerOutput:!0,useStdLib:!1},At={compiler:"g++",standard:"c++20",optimization:w,flags:A,libraries:`${R} -latomic`,extraCommands:"",alwaysShowCompilerOutput:!1,useStdLib:!1},Rt=s=>T[s].map(e=>e.name),Tt=(s,e)=>{const t=T[e].find(r=>r.name===s);return t?t.standards:[]},H=(s,e)=>T[e].find(t=>t.name===s),zt=(s,e,t)=>H(s,t)?.additionalLibs?.[e]||"",J=s=>"g++",W=s=>s==="cpp"?"c++20":"c2x",It=(s,e)=>{const t={...s},r=Rt(e),o=J(e);s.compiler&&!r.includes(s.compiler)&&(console.warn(`Invalid ${e} compiler: ${s.compiler}. Using default: ${o}`),t.compiler=o);const c=t.compiler||o,i=Tt(c,e),d=W(e);s.standard&&!i.includes(s.standard)&&(console.warn(`${c} does not support ${s.standard}. Using default: ${d}`),t.standard=d);const n=["O0","O1","O2","O3","Os","Og","Ofast"];return s.optimization&&!n.includes(s.optimization)&&(console.warn(`Invalid optimization level: ${s.optimization}. Using default: ${w}`),t.optimization=w),t},Mt=s=>{const{currentPage:e,slides:t}=V(),r=e.value;if(r===void 0||!t.value||t.value.length===0)return{};const o=t.value.find(c=>c.no===r);return!o||!o.meta.slide?{}:o.meta.slide.frontmatter?.[s]||{}},Pt=(s,e)=>{const t=It(s,e),r=t.compiler||J(e),o=t.standard||W(e),c=H(r,e),i={compiler:r,langFlag:e==="cpp"?"":"-x c",standard:`-std=${o}`,stdlib:r==="clang++"&&t.useStdLib&&c?.stdlibFlag||"",optimization:t.optimization?`-${t.optimization}`:`-${w}`,flags:t.flags||A,sourcefile:"main.cpp",libraries:t.libraries||`${R}`,additionalLibs:zt(r,o,e)},n=t.alwaysShowCompilerOutput||!1?N.ALWAYS_SHOW:N.DEFAULT;let l=[i.compiler,i.langFlag,i.standard,i.stdlib,i.optimization,i.flags,i.sourcefile,i.libraries,i.additionalLibs].filter(Boolean).join(" ")+" "+n;return t.extraCommands&&(l+=`; ${t.extraCommands}`),l},D=_(!1),B=async(s,e)=>{try{D.value=!0;const t=Mt(e),o={...e==="cpp"?At:Et,...t};console.log(`Running ${e} with config:`,o);const c=Pt(o,e);return{text:await(await fetch(kt.config.coliru.compileUrl,{method:"POST",body:JSON.stringify({cmd:c,src:s+`
`}),cache:"default"})).text(),highlightLang:"ansi"}}catch(t){return{text:t instanceof Error?t.message:String(t),class:"text-red"}}finally{D.value=!1}},jt=pt(s=>({c:async(e,t)=>B(e,"c"),cpp:async(e,t)=>B(e,"cpp")})),Nt=[jt],Dt=dt(async()=>{const s={javascript:L,js:L,typescript:L,ts:L},{getHighlighter:e}=await U(async()=>{const{getHighlighter:o}=await import("./shiki-CqTp1krF.js");return{getHighlighter:o}},__vite__mapDeps([0,1,2,3,4,5,6])),t=await e(),r=async(o,c,i)=>{try{const d=s[c];if(!d)throw new Error(`Runner for language "${c}" not found`);return await d(o,{options:i,highlight:t,run:async(n,a)=>await r(n,a,i)})}catch(d){return console.error(d),{error:`${d}`}}};for(const o of Nt){const c=await o(s);Object.assign(s,c)}return{highlight:t,run:r}});function Bt(s){const e=_([]),t=n=>e.value.push({error:String(n)}),r=(...n)=>e.value.push(n.map(c)),o=Object.assign({},console);o.info=o.log=o.debug=o.warn=o.error=r,o.clear=()=>e.value.length=0;try{const n=`return async (console, __slidev_import, __slidev_on_error) => {
      try {
        ${d(s)}
      } catch (e) {
        __slidev_on_error(e)
      }
    }`;new Function(n)()(o,a=>{const l=j[a];if(!l)throw new Error(`Module not found: ${a}.
Available modules: ${Object.keys(j).join(", ")}. Please refer to https://sli.dev/custom/config-code-runners#additional-runner-dependencies`);return l},t)}catch(n){t(n)}function c(n){return typeof n=="string"?{text:n}:{text:i(n),highlightLang:"javascript"}}function i(n){let a="";if(n instanceof Error)a=`Error: ${JSON.stringify(n.message)}`;else if(n==null||typeof n=="symbol")a=String(n);else if(Array.isArray(n))a=`[${n.map(i).join(", ")}]`;else if(n instanceof Set){const l=[...n];a=`Set (${n.size}) {${l.map(i).join(", ")}}`}else if(n instanceof Map){const l=[...n.entries()];a=`Map (${n.size}) {${l.map(([m,v])=>`${i(m)} => ${i(v)}`).join(", ")}}`}else if(n instanceof RegExp)a=n.toString();else if(typeof n=="string")a=JSON.stringify(n);else if(typeof n=="object"){const l=n.constructor?.name??"",m=l&&l==="Object"?"":l;a=(m?`${m}: `:"")+JSON.stringify(n,(g,y)=>y===void 0?"__undefined__":y,2).replace(/"__undefined__"/g,"undefined"),a=String(a)}else a=String(n);return a}function d(n){return n=n.replace('import "reflect-metadata"',"").replace('require("reflect-metadata")',""),n=n.replace("export {};",""),n}return e}let O;async function L(s){O??=await U(()=>import("../monaco/bundled-types-DTJSzuqq.js").then(t=>t.t),__vite__mapDeps([1,2,3,4])),s=O.transpileModule(s,{compilerOptions:{module:O.ModuleKind.ESNext,target:O.ScriptTarget.ES2022},transformers:{after:[Ft]}}).outputText;const e=/import\s*\((.+)\)/g;return s=s.replace(e,(t,r)=>`__slidev_import(${r})`),Bt(s)}function Ft(s){const{factory:e}=s,{isImportDeclaration:t,isNamedImports:r,NodeFlags:o}=O;return c=>{const i=[...c.statements];for(let d=0;d<i.length;d++){const n=i[d];if(!t(n))continue;let a;const l=n.importClause?.namedBindings,m=[];if(n.importClause?.name&&m.push(e.createBindingElement(void 0,e.createIdentifier("default"),n.importClause.name)),l)if(r(l)){for(const g of l.elements)m.push(e.createBindingElement(void 0,g.propertyName,g.name));a=e.createObjectBindingPattern(m)}else a=e.createIdentifier(l.name.text);else a=e.createObjectBindingPattern(m);const v=e.createVariableStatement(void 0,e.createVariableDeclarationList([e.createVariableDeclaration(a,void 0,void 0,e.createAwaitExpression(e.createCallExpression(e.createIdentifier("import"),void 0,[n.moduleSpecifier])))],o.Const));i[d]=v}return e.updateSourceFile(c,i)}}const Ut=F({__name:"DomElement",props:{element:{}},setup(s){const e=s,t=_();return Y(()=>{t.value&&t.value.appendChild(e.element)}),(r,o)=>(u(),p("div",{ref_key:"container",ref:t},null,512))}}),Vt={key:0,class:"text-sm text-center opacity-50"},Ht={key:1,class:"text-sm text-center opacity-50"},Jt={key:2,class:"text-sm text-center opacity-50"},Wt=["innerHTML"],Gt={key:1,class:"text-red-500"},Yt={key:3,class:"output-line"},qt=["innerHTML"],Kt={key:2,class:"separator"},Xt={key:0,class:"absolute right-1 top-1 max-h-full flex gap-1"},ie=F({__name:"CodeRunner",props:{modelValue:{},lang:{},autorun:{type:[Boolean,String]},height:{},showOutputAt:{type:[null,Boolean,String,Number,Array]},highlightOutput:{type:Boolean},runnerOptions:{}},emits:["update:modelValue"],setup(s,{emit:e}){const t=s,r=e,{isPrintMode:o}=V(),c=et(t,"modelValue",r),{$renderContext:i,$clicksContext:d}=ft(),n=q(()=>!["slide","presenter"].includes(i.value)),a=o.value?"once":t.autorun,l=_(a),m=K(),v=_(0),g=_(),y=_(t.showOutputAt);if(t.showOutputAt){const b=mt();X(()=>{const h=d.calculate(t.showOutputAt);h?(d.register(b,h),Z(()=>{y.value=!h.isActive.value})):y.value=!1}),Q(()=>d.unregister(b))}const $=ut(200,async()=>{if(n.value)return;const{highlight:b,run:h}=await Dt();g.value=b;const f=setTimeout(()=>{l.value=!0},500);m.value=await h(c.value,t.lang,t.runnerOptions??{}),v.value+=1,l.value=!1,clearTimeout(f)});return a==="once"?$():a&&tt(c,$,{immediate:!0}),(b,h)=>(u(),p(C,null,[nt(M("div",{class:"relative flex flex-col rounded-b border-t border-main",style:rt({height:t.height}),"data-waitfor":".slidev-runner-output"},[n.value?(u(),p("div",Vt,' Code is disabled in the "'+k(S(i))+'" mode ',1)):l.value?(u(),p("div",Ht," Running... ")):m.value?(u(),p("div",{key:`run-${v.value}`,class:"slidev-runner-output"},[(u(!0),p(C,null,P(S(E)(at(m.value)),(f,G)=>(u(),p(C,{key:G},["html"in f?(u(),p("div",{key:0,innerHTML:f.html},null,8,Wt)):"error"in f?(u(),p("div",Gt,k(f.error),1)):"element"in f?(u(),ot(Ut,{key:2,element:f.element},null,8,["element"])):(u(),p("div",Yt,[(u(!0),p(C,null,P(S(E)(f),(x,z)=>(u(),p(C,{key:z},[x.highlightLang&&g.value?(u(),p("span",{key:0,class:"highlighted",innerHTML:g.value(x.text,x.highlightLang)},null,8,qt)):(u(),p("span",{key:1,class:it(x.class)},k(x.text),3)),z<S(E)(f).length-1?(u(),p("span",Kt,",")):I("v-if",!0)],64))),128))]))],64))),128))])):(u(),p("div",Jt," Click the play button to run the code "))],4),[[st,!y.value]]),S(c).trim()?(u(),p("div",Xt,[ct(ht,{class:"w-8 h-8 max-h-full flex justify-center items-center",title:"Run code",onClick:S($)},{default:lt(()=>[...h[0]||(h[0]=[M("div",{class:"i-carbon:play"},null,-1)])]),_:1},8,["onClick"])])):I("v-if",!0)],64))}});export{ie as default};
