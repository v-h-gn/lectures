import{ai as B,aj as M,ak as D,v as I,C as q,al as G,am as K}from"../index-Dofigz7l.js";import{d as x,L as V,O as E,o as b,c as N,F as R,aJ as F,v as f,aK as C,aL as O,l as T,ah as j,t as J,D as L,z as w,aM as U,b as $,f as W,B as A,g as X,i as P,h as Q}from"../modules/vue-DQEmT7T4.js";import{u as H}from"./context-D_4ROvkV.js";import{e as Y,f as Z}from"../modules/unplugin-icons-DZ7mV1e_.js";const ee=x({__name:"VClickGap",props:{size:{type:[String,Number],default:1}},setup(y){const e=y,{$clicksContext:c}=H(),a=B();let u=+e.size;return Number.isNaN(u)&&(console.warn(`[slidev] Invalid size for VClickGap: ${e.size}`),u=1),V(()=>{const d=c.currentOffset+u-1;c.register(a,{max:d,delta:u})}),E(()=>{c.unregister(a)}),(d,n)=>(b(),N(R))}}),z=["ul","ol"],ae=x({props:{depth:{type:[Number,String],default:1},every:{type:[Number,String],default:1},at:{type:[Number,String],default:"+1"},hide:{type:Boolean,default:!1},fade:{type:Boolean,default:!1},handleSpecialElements:{type:Boolean,default:!0}},render(){var h,v;const y=+this.every,e=M(this.at),c=typeof e=="string";if(!e){console.warn("[slidev] Invalid at prop for v-clicks component:",e);return}const a=F("click"),u=(l,t)=>j(l,[[a,t,"",{hide:this.hide,fade:this.fade}]]),d=l=>l.flatMap(t=>C(t)&&typeof t.type=="symbol"&&Array.isArray(t.children)?d(t.children):[t]);let n=(v=(h=this.$slots).default)==null?void 0:v.call(h);if(!n)return;n=d(D(n));const S=(l,t=1)=>d(l).map(r=>{if(!C(r))return r;if(z.includes(r.type)&&Array.isArray(r.children)){const m=i(r.children,t+1);return f(r,{},m)}return f(r)});let s=1,o=0;const i=(l,t=1)=>d(l).map(r=>{if(!C(r)||r.type===O)return r;const m=+e+Math.ceil(s++/y)-1;let g;t<+this.depth&&Array.isArray(r.children)?g=f(r,{},S(r.children,t)):g=f(r);const _=m-o;return o=m,u(g,c?_>=0?`+${_}`:`${_}`:m)}),p=()=>T(ee,{size:+e+Math.ceil((s-1)/y)-1-o});if(this.handleSpecialElements){if(n.length===1&&z.includes(n[0].type)&&Array.isArray(n[0].children))return f(n[0],{},[...i(n[0].children),p()]);if(n.length===1&&n[0].type==="table"){const l=n[0];if(Array.isArray(l.children))return f(l,{},l.children.map(t=>C(t)?t.type==="tbody"&&Array.isArray(t.children)?f(t,{},[...i(t.children),p()]):f(t):t))}}return[...i(n),p()]}}),te=["title"],oe=x({__name:"CodeBlockWrapper",props:{ranges:{type:Array,default:()=>[]},finally:{type:[String,Number],default:"last"},startLine:{type:Number,default:1},lines:{type:Boolean,default:I.lineNumbers},at:{type:[String,Number],default:"+1"},maxHeight:{type:String,default:void 0}},setup(y){const e=y,{$clicksContext:c}=H(),a=J(),u=B();E(()=>{c.unregister(u)}),L(()=>{var s;(s=a.value)==null||s.classList.toggle("slidev-code-line-numbers",e.lines)}),V(()=>{var p;if(!c||!((p=e.ranges)!=null&&p.length))return;const s=c.calculateSince(e.at,e.ranges.length-1);c.register(u,s);const o=w(()=>s?Math.max(0,c.current-s.start+1):q),i=w(()=>e.finally==="last"?e.ranges.at(-1):e.finally.toString());L(()=>{if(!a.value)return;let h=e.ranges[o.value]??i.value;const v=h==="hide";a.value.classList.toggle(G,v),v&&(h=e.ranges[o.value+1]??i.value);const l=a.value.querySelector(".shiki"),t=Array.from(l.querySelectorAll("code > .line")),k=t.length;if(K(h,k,e.startLine,r=>[t[r]]),e.maxHeight){const r=Array.from(l.querySelectorAll(".line.highlighted"));r.reduce((g,_)=>_.offsetHeight+g,0)>a.value.offsetHeight?r[0].scrollIntoView({behavior:"smooth",block:"start"}):r.length>0&&r[Math.round((r.length-1)/2)].scrollIntoView({behavior:"smooth",block:"center"})}})});const{copied:d,copy:n}=U();function S(){var o,i;const s=(i=(o=a.value)==null?void 0:o.querySelector(".slidev-code"))==null?void 0:i.textContent;s&&n(s)}return(s,o)=>{const i=Y,p=Z;return b(),$("div",{ref_key:"el",ref:a,class:P(["slidev-code-wrapper relative group",{"slidev-code-line-numbers":e.lines}]),style:Q({"max-height":e.maxHeight,"overflow-y":e.maxHeight?"scroll":void 0,"--start":e.startLine})},[W(s.$slots,"default"),A(I).codeCopy?(b(),$("button",{key:0,class:"slidev-code-copy absolute top-0 right-0 transition opacity-0 group-hover:opacity-20 hover:!opacity-100",title:A(d)?"Copied":"Copy",onClick:o[0]||(o[0]=h=>S())},[A(d)?(b(),N(i,{key:0,class:"p-2 w-8 h-8"})):(b(),N(p,{key:1,class:"p-2 w-8 h-8"}))],8,te)):X("v-if",!0)],6)}}});export{oe as _,ae as a};
